//************************************Stor products ******************************************* */
  let productsWomen = [
    {"id":1352054853,
    "img":"../assets/women/product5/Le-Dino-Lisse-Noir-01.jpg",
    "images":["../assets/women/product5/Le-Dino-Lisse-Noir-02.jpg ","../assets/women/product5/Le-Dino-Lisse-Noir-03.jpg"],
"name":"Le Dino Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":440.00,
"color": [1, 2, 3],
"mayLike": [2, 3, 4],

},
    {"id":2315767263,
    "img":"../assets/women/product4/Le-Dino-Lisse-Ivoire-01.jpg",
    "images":["../assets/women/product4/Le-Dino-Lisse-Ivoire-02.jpg ","../assets/women/product4/Le-Dino-Lisse-Ivoire-03.jpg"],
"name":"Le Dino Ivory Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":440.00,
        "color": [1, 2, 3],
"mayLike": [0, 5, 6],

},
    {"id":9554332882,
    "img":"../assets/women/product3/Grand-Nova-Lisse-Ivoire-013.jpg",
    "images":["../assets/women/product3/Grand-Nova-Lisse-Ivoire-02.jpg","../assets/women/product3/Grand-Nova-Lisse-Ivoire-3.jpg"],
"name":"Le Dalia Ivory Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [1, 3, 4],

},
    {"id":8066803543,
    "img":"./assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-01.jpg",
    "images":["../assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-02.jpg ","../assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-03.jpg"],
"name":"Le Mini Dalia Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3852779280,
    "img":"./assets/women/product1/Le-Mini-Dalia-Lisse-Noir-01.jpg ",
    "images":["../assets/women/product1/Le-Mini-Dalia-Lisse-Noir-04.jpg ","../assets/women/product1/Le-Mini-Dalia-Lisse-Noir-05.jpg .jpg"],
"name":"Le Dalia Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3852778580,
    "img":"./assets/women/product7/Dalia-Embosse-lezard-Camel-01.jpg",
    "images":["../assets/women/product7/Nova-Embosse-Lezard-Camel-02.jpg ","../assets/women/product7/Dalia-Embosse-lezard-Camel-03.jpg"],
"name":"Le Dalia Printed Lizard Camel",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3852779900,
    "img":"./assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-01.jpg",
    "images":["../assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-02.jpg ","../assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-03.jpg"],
"name":"Le Mini Dalia Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3985779280,
    "img":"./assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-01.jpg",
    "images":["../assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-02.jpg ","../assets/women/product6/Le-Mini-Dalia-Lisse-Ivoire-03 .jpg"],
"name":"Le Mini Dalia Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3852763280,
    "img":"./assets/women/product8/Elegant-Cuir-Miroir-Noir-01.jpg",
    "images":["../assets/women/product8/Elegant-Cuir-Miroir-Noir-02.jpg ","../assets/women/product8/Elegant-Cuir-Miroir-Noir-04.jpg"],
"name":"Le Napoli Black",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":480.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":8965779280,
    "img":"./assets/women/product9/ipad-le-sac-elegant-1.jpg",
    "images":["../assets/women/product8/Elegant-Cuir-Miroir-Noir-02.jpg ","../assets/women/product8/Elegant-Cuir-Miroir-Noir-04.jpg"],
"name":"Le Napoli Burgundy",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":480.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3852773330,
    "img":"./assets/women/product8/Elegant-Cuir-Miroir-Noir-01.jpg",
    "images":["../assets/women/product9/ipad-le-sac-elegant-4.jpg ","../assets/women/product8/Elegant-Cuir-Miroir-Noir-04.jpg"],
"name":"Le Mini Dalia Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
    {"id":3852778989,
    "img":"./assets/women/product8/Elegant-Cuir-Miroir-Noir-01.jpg",
    "images":["../assets/women/product8/Elegant-Cuir-Miroir-Noir-02.jpg ","../assets/women/product8/Elegant-Cuir-Miroir-Noir-04.jpg"],
"name":"Le Mini Dalia Black Liégé",
"desc":"'Baguette' bag created in collaboration with Wendy Swan. Inspired by the Parisian and minimalist style of Wendy, this bag is constructed with 3 flexible gussets allowing a good capacity. Two shoulder straps for shoulder or cross-body carry. Optional short shoulder strap. XL smartphone compatible (ex iPhone 13 pro Max). Secure turnstile clasp, brass. Handmade in Italy.",
"price":380.00,
        "color": [1, 2, 4],
"mayLike": [2, 3, 4],

},
];
//*******************************select elements with class products and cart ************************ */
let main_prod = document.querySelector(".products")
let cartItems = document.getElementById("cartItems");
let cartTotal = document.getElementById("cartTotal");

// adding products

addProduct(productsWomen)
let cart = [];

//chech if there is products in localstorage
if (localStorage.getItem("cart")) {
    cart = JSON.parse(localStorage.getItem("cart"))
}
//update the cart HTML
getDataLocalStr();

//adding function
function addProduct (products){

    for (let i = 0; i < products.length; i++) {

        let imgProduct = document.createElement("img");
        let divProduct = document.createElement("div");
        let btnCont = document.createElement("div");
        let nameProduct =document.createElement("h3");
        let priceProducnt = document.createElement("h6");
        let more = document.createElement("button");
        let btnProducnt = document.createElement("i");
        let nameText =document.createTextNode(`${products[i].name}`);
        let priceText =document.createTextNode(`$${products[i].price}`);
        let moreTxt =document.createTextNode("show more");
        
        imgProduct.src= products[i].img;
        nameProduct.appendChild(nameText);
        priceProducnt.appendChild(priceText);
        more.appendChild(moreTxt);
        
        btnProducnt.classList.add("fa-solid", "fa-plus")  
        divProduct.setAttribute("class","product")
        divProduct.setAttribute("data-id",products[i].id)
        btnCont.setAttribute("class", "product_add")
        btnCont.setAttribute("data-id", products[i].id)
        imgProduct.setAttribute("class","product_img")
        nameProduct.setAttribute("class","product_name")
        priceProducnt.setAttribute("class", "product_price")
        more.setAttribute("class", "show_more")
        
        btnCont.appendChild(btnProducnt)
        divProduct.appendChild(imgProduct)
        divProduct.appendChild(nameProduct)
        divProduct.appendChild(priceProducnt)
        divProduct.appendChild(btnCont)
        divProduct.appendChild(more)
        main_prod.appendChild(divProduct)
    }

}

/*************************************Show user cart ******************************* */ 
let userCart = document.getElementById("userCart");
let addToCartBtn = document.querySelectorAll(".product_add");
let closeBtn = document.getElementById("closeBtn");
let showBtn = document.querySelector(".show_cart")


function addCart(products) {
    for (let i = 0; i < addToCartBtn.length; i++) {
        addToCartBtn[i].addEventListener('click', () => {
            //verify if the element already exist

            const findItem = cart.find(item => item.id == addToCartBtn[i].getAttribute("data-id"))
            const findItemBool = cart.find(item => item.id == addToCartBtn[i].getAttribute("data-id"))!== undefined ? true : false
            console.log('cart: ', cart);
            console.log('findItem: ', findItem);
            //increament quantity
            if (findItemBool) {
                findItem.quantity += 1;
            }
            //add element to cart
            else {
                let id = products[i].id
                let img = products[i].img
                let name = products[i].name;
                let price = products[i].price
                cart.push({
                    id,
                    img,
                    name,
                    price,
                    quantity: 1,
                })
            
            }
            //update the local storage with the new cart
            addDataToLocalSFrom(cart)
            //add it to HTML
            updateCart(cart)
            showCart()
        })

    }
}

addCart(productsWomen)

function showCart() {
    userCart.classList.add('show');
}

function hideCart() {
    userCart.classList.remove('show');
}
//removing cart if i click outside
window.addEventListener('click', (e) => {
    if (e.target === userCart) {
        hideCart();
    }
});
closeBtn.addEventListener('click',hideCart);


function updateCart(cart) {
    if (cart.length === 0) {
        cartItems.innerHTML = '<p class="text-gray-500 text-center py-4">Your cart is empty</p>';
    }else{
    cartItems.innerHTML= cart.map(item=>`        
        <div class="user_cart-item" data-id=${item.id}>
            <div>
                 <img src="${item.img}" class ="cart_img" alt="">
                <h3>${item.name}</h3>
                <p>Quantity: ${item.quantity}</p>
                </div>
                <div>  
                <p>$${(item.price * item.quantity).toFixed(2)}</p>
                <button 
                        class="remove-item remove_pro" 
                        aria-label="Remove item" data-id=${item.id} >Remove</button>
            </div>
           <hr>
        </div>  `).join('');

    
    }


    const total = cart.reduce((sum,item)=>{return sum+(item.price * item.quantity)},0)
    cartTotal.textContent = total.toFixed(2);
 let items = document.getElementsByClassName("user_cart-item")
for (let i = 0; i < items.length; i++) {
    items[i].addEventListener("click", (e) => {
        if (e.target.classList.contains("remove-item")) {
            removeFromCart(e.target.parentElement.parentElement.getAttribute("data-id"))        
            e.target.parentElement.parentElement.remove()
        }
    })
}
}
   

function removeFromCart(id) {
    cart = cart.filter((item) => {
        return item.id !=id
    });
    updateCart(cart);
   addDataToLocalSFrom(cart)
}
showBtn.onclick=()=>{
    showCart()
}

/****************************************LS********************************** */
function getDataLocalStr() {
    let data = window.localStorage.getItem("cart");
    if (data) {
        //array has data in local storage
        let arr = JSON.parse(data) 
        updateCart(arr)
    }
}
function addDataToLocalSFrom(cart) {
    window.localStorage.setItem("cart",JSON.stringify(cart))
}

/* styling */

let women_pro = document.querySelectorAll(".product")

//change main image when mouse overing
function changeImg(products) {
    let image = document.querySelectorAll(".product_img")
    for (let i = 0; i < products.length; i++) {
        products[i].addEventListener("mouseover", (e) => {
            if (e.target.classList.contains("product_img")) {
                image[i].src=`${productsWomen[i]["images"][0]}`
            }
        })
        products[i].addEventListener("mouseout", (e) => {
            if (e.target.classList.contains("product_img")) {
                image[i].src=`${productsWomen[i]["img"]}`
            }
        })
        
    }
}
//call function
changeImg(women_pro)
/****************************************description product************************ */
localStorage.setItem('WomanProducts', JSON.stringify(productsWomen));
 export function showDes(products) {
        for (let i = 0; i < products.length; i++) {
        
        products[i].addEventListener("click", function (e) {
                if (e.target.classList.contains("show_more")) {
                    localStorage.setItem('selectedProduct', JSON.stringify(productsWomen[i]));
                    let realtedProd = productsWomen[i].mayLike;
                    for (let j = 0; j < realtedProd.length; j++) {
                    localStorage.setItem(`realtedProd${j}`, JSON.stringify(productsWomen[realtedProd[j]]));
                        
                    }
                    
                    localStorage.setItem('selectedProduct', JSON.stringify(productsWomen[i]));
            
                    
                    location.href = "../showPr.html"

            }
        })
    }

}
showDes(women_pro)


//************************filtering*********************

const searchInput = document.getElementById('searchName');

const prod = document.querySelectorAll(".product")
function filterProducts(){
    //get the label input
    const searchTerm = searchInput.value.toLowerCase();
searchInput.style.backgroundColor = 'white';
    for (let i = 0; i < productsWomen.length; i++) {
        //show the element with the same name
        if(productsWomen[i].name.toLowerCase() === searchTerm){
            // let pr_id = productsWomen[i].id;
            prod[i].classList.remove('hidden');
            console.log("added")

        }
        //hide the element without the same name
        else{
            prod[i].classList.add('hidden');
        }
        
    }

}

searchInput.addEventListener('input', filterProducts);

searchInput.addEventListener('input', ()=>{
    const searchTerm = searchInput.value.toLowerCase();
    for (let i = 0; i < productsWomen.length; i++) {

            if(searchTerm =="")
                prod[i].classList.remove('hidden');
            
    }
    
});
searchInput.addEventListener('blur', () => {
    searchInput.style.backgroundColor="#2f332f"
});
searchInput.addEventListener('focus', () => {
    searchInput.style.backgroundColor="white"
});